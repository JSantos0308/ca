<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Caméra invisible</title>
</head>
<body>
  <h1>Caméra active, flux masqué</h1>
  <button id="start">Commencer l'enregistrement</button>
  <button id="stop">Arrêter et télécharger</button>

  <script>
    let mediaRecorder;
    let recordedChunks = [];

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        // PAS d'affichage du flux vidéo
        // Aucun élément <video> visible

        // Préparer l'enregistrement
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "enregistrement_invisible.webm";
          a.click();
        };

        document.getElementById("start").onclick = () => {
          recordedChunks = [];
          mediaRecorder.start();
          alert("Enregistrement commencé (caméra invisible)");
        };

        document.getElementById("stop").onclick = () => {
          mediaRecorder.stop();
          alert("Enregistrement terminé.");
        };
      })
      .catch(err => {
        console.error("Erreur d'accès à la caméra :", err);
        alert("Accès caméra refusé ou indisponible.");
      });
  </script>
</body>
</html>
